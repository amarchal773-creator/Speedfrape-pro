<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeedType Pro - Teste ta vitesse de frappe</title>
    <style>
        :root { --bg: #323437; --not-typed: #646669; --typed: #4ade80; --error: #ca4754; --main: #e2b714; --sub: #2c2e31; }
        body { background: var(--bg); color: white; font-family: 'Courier New', monospace; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        /* Header & Ads */
        .ad-banner { width: 728px; height: 90px; background: var(--sub); margin: 20px 0; border: 1px solid #444; display: flex; align-items: center; justify-content: center; color: #555; border-radius: 8px; }
        
        /* Stats Bar */
        .stats-bar { display: flex; gap: 40px; margin: 20px 0; font-size: 24px; color: var(--main); font-weight: bold; }
        .high-score { font-size: 14px; color: #888; margin-top: 5px; }

        /* Setup Area */
        .card { background: var(--sub); padding: 30px; border-radius: 12px; border: 1px solid #444; width: 600px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        textarea { width: 100%; height: 120px; background: #3e4144; border: 1px solid #555; color: white; padding: 15px; border-radius: 8px; font-size: 16px; margin: 15px 0; box-sizing: border-box; resize: none; }
        textarea:focus { border-color: var(--main); outline: none; }
        
        select, button { padding: 12px 25px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; font-size: 16px; }
        select { background: #444; color: white; margin-right: 10px; }
        button { background: var(--main); color: #000; transition: 0.3s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(226, 183, 20, 0.4); }

        /* Game Area */
        #text-display { font-size: 28px; max-width: 1000px; line-height: 1.5; word-break: break-word; padding: 20px; }
        .char { color: var(--not-typed); position: relative; }
        .char.correct { color: var(--typed); }
        .char.wrong { color: var(--error); background: rgba(202, 71, 84, 0.2); border-radius: 2px; }
        .char.current { border-left: 3px solid var(--main); margin-left: -3px; animation: blink 1s infinite; }
        @keyframes blink { 50% { border-color: transparent; } }
        
        #hidden-input { position: absolute; opacity: 0; pointer-events: none; }

        /* SEO Content */
        .seo-content { max-width: 800px; margin-top: 100px; padding: 40px; color: #888; line-height: 1.8; font-size: 14px; border-top: 1px solid #444; }
        h2 { color: var(--main); font-size: 18px; }
    </style>
</head>
<body>

    <div class="ad-banner">PUBLICITÉ (Google AdSense)</div>

    <div id="stats" class="stats-bar" style="display:none;">
        <div>Temps : <span id="timer">--</span></div>
        <div>WPM : <span id="wpm">0</span></div>
        <div style="font-size: 14px; color: #888;">Record : <span id="best-wpm">0</span></div>
    </div>

    <div id="setup" class="card">
        <h1 style="margin-top:0; color:var(--main)">SpeedType Pro</h1>
        <p>Entraîne-toi sur tes propres textes.</p>
        <textarea id="custom-text">Économisez votre temps et gagnez en efficacité en apprenant à taper plus vite chaque jour sur notre plateforme gratuite !</textarea>
        
        <div style="margin-bottom:20px;">
            <select id="duration">
                <option value="0">Mode Libre</option>
                <option value="15">15 Secondes</option>
                <option value="30">30 Secondes</option>
                <option value="60">1 Minute</option>
            </select>
            <button onclick="startGame()">DÉMARRER</button>
        </div>
    </div>

    <div id="game" style="display:none; text-align:center;">
        <div id="text-display"></div>
        <input type="text" id="hidden-input">
        <p style="color:#555; margin-top:50px;">Appuie sur <b>Echap</b> pour annuler</p>
    </div>

    <div class="seo-content">
        <h2>Pourquoi utiliser notre test de vitesse de frappe ?</h2>
        <p>Améliorer sa vitesse de dactylographie est essentiel pour tout codeur ou rédacteur web. En utilisant notre outil gratuit de <strong>WPM test</strong>, vous pouvez coller vos propres textes pour vous entraîner dans des conditions réelles. Notre algorithme calcule votre vitesse de frappe par minute (Words Per Minute) et votre précision en temps réel.</p>
        <h2>Comment calculer son WPM ?</h2>
        <p>La formule standard est simple : (Nombre de caractères / 5) / temps en minutes. Un bon score se situe au-dessus de 60 WPM. Entraînez-vous quotidiennement pour atteindre les 100 WPM !</p>
    </div>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playClickSound(freq = 150, type = 'sine', duration = 0.05) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + duration);
        }

        let originalText = "";
        let timerInterval = null;
        let startTime = null;
        let isChrono = false;
        let duration = 0;

        // Charger record
        document.getElementById('best-wpm').innerText = localStorage.getItem('bestWpm') || 0;

        function startGame() {
            let rawText = document.getElementById('custom-text').value.trim();
            originalText = rawText.replace(/É/g, 'E').replace(/À/g, 'A').replace(/Ç/g, 'C'); // Nettoyage auto

            duration = parseInt(document.getElementById('duration').value);
            isChrono = duration > 0;

            const display = document.getElementById('text-display');
            display.innerHTML = "";
            originalText.split('').forEach((char, i) => {
                const span = document.createElement('span');
                span.innerText = char;
                span.classList.add('char');
                if (i === 0) span.classList.add('current');
                display.appendChild(span);
            });

            document.getElementById('setup').style.display = "none";
            document.getElementById('stats').style.display = "flex";
            document.getElementById('game').style.display = "block";
            document.getElementById('hidden-input').value = "";
            document.getElementById('hidden-input').focus();
            document.getElementById('timer').innerText = isChrono ? duration + "s" : "Libre";
        }

        document.getElementById('hidden-input').addEventListener('input', function() {
            if (!startTime) {
                startTime = new Date();
                timerInterval = setInterval(updateStats, 1000);
            }

            playClickSound(200, 'square', 0.02); // Son mécanique
            
            const typed = this.value;
            const spans = document.querySelectorAll('.char');

            spans.forEach((span, i) => {
                span.className = 'char';
                if (i < typed.length) {
                    if (typed[i] === originalText[i]) span.classList.add('correct');
                    else span.classList.add('wrong');
                }
                if (i === typed.length) span.classList.add('current');
            });

            if (typed.length >= originalText.length) endGame("Bravo !");
        });

        function updateStats() {
            const now = new Date();
            const elapsed = Math.floor((now - startTime) / 1000);
            
            if (isChrono) {
                let remains = duration - elapsed;
                document.getElementById('timer').innerText = remains + "s";
                if (remains <= 0) endGame("Temps écoulé !");
            } else {
                document.getElementById('timer').innerText = elapsed + "s";
            }

            const mins = elapsed / 60;
            const wpm = Math.round((document.getElementById('hidden-input').value.length / 5) / mins);
            if (mins > 0) document.getElementById('wpm').innerText = wpm;
        }

        function endGame(msg) {
            clearInterval(timerInterval);
            const wpm = parseInt(document.getElementById('wpm').innerText);
            const best = localStorage.getItem('bestWpm') || 0;
            
            if (wpm > best) {
                localStorage.setItem('bestWpm', wpm);
                msg += " Nouveau record !";
            }

            alert(`${msg}\nScore : ${wpm} WPM`);
            location.reload();
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === "Escape") location.reload();
        });
        document.addEventListener('click', () => {
            if (document.getElementById('game').style.display === "block") document.getElementById('hidden-input').focus();
        });
    </script>
</body>
</html>
